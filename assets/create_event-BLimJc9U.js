import{s as h}from"./config-Cz5MLLdD.js";import"https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";function m(){document.getElementById("loadingOverlay").style.display="block"}function y(){document.getElementById("loadingOverlay").style.display="none"}const o=document.querySelector("#shopSelect"),d=document.querySelector("#otherBox"),n=document.querySelector("#shopOther");o.addEventListener("change",()=>{o.value==="__other"?(d.classList.remove("hidden"),n.focus()):(d.classList.add("hidden"),n.value="")});async function p(){const r=o.value,t=r==="__other"?n.value.trim():r.trim(),c=document.querySelector("#deadline").value;if(!t)return alert("請選擇店家或輸入自訂店名");m();try{const{data:e,error:a}=await h.from("events").insert([{title:t+" 訂單",shop:t,deadline:c?new Date(c).toISOString():null,status:"open"}]).select();if(a)throw a;if(!e||e.length===0)throw new Error("資料已寫入但無法讀取回傳值，請確認資料庫 RLS 設定。");const u=e[0].id,l=new URL("order.html",location.href);l.searchParams.set("event",u);const s=l.toString(),i=document.querySelector("#shareLink");i.value=s,document.querySelector("#result").style.display="block",document.querySelector("#copyBtn").onclick=async()=>{try{await navigator.clipboard.writeText(s),alert("已複製下單連結")}catch{i.select(),document.execCommand("copy"),alert("已複製")}}}catch(e){console.error("建立失敗原因:",e),alert("建立失敗："+e.message)}finally{y()}}document.querySelector("#createBtn").addEventListener("click",p);
